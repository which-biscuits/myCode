<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>学生成绩管理</title>
    <style>
        .input_divs{    /* 输入选择框的 div样式 */
            display: inline-block;     /* 转行内标签 */
            margin-top: 5px;
            width: 400px;
            text-align: left;
        }
        .input{     /* 文本输入框的大小 */
            width: 380px;
            height: 30px;
        }
        .name{      /* 输入框名称的 div 样式 */
            display: inline-block;
            text-align: right;
            width: 100px;
        }
        table.title{    /* 信息表格的样式 */
            margin-top: 80px;
            text-align: center;
            width: 820px;
            border-color: lightgray;
        }
        .buttons{   /* 按钮样式 */
            color: white;
            background-color: #121299 ;
            border-width: 0px;
            width: 120px;
            height: 35px;
        }
        div.divs{   /* 按钮 div 样式 */
            margin-top: 10px;
            text-align: center;
        }
        .titles{    /* 标题样式 */
            font-size: 15px;

        }
        tr.tr{      /* 表格 行样式 */
            height: 35px;
        }
        .error{     /* 显示输入错误信息的div样式 */
            width: 150px;
            display: inline-block;
        }
        div.remove,div.modify{   /* 表格 修改/删除 操作按钮样式 */
            color: deepskyblue;
            text-decoration: underline;
            display: inline-block;
        }
    </style>
</head>
<body>
    <form action="./success.html" method="post">
        <!--  存储学生信息的表单  -->
        <table class="title" id="table" border="1" cellspacing="0" align="center">
            <th colspan="8" class="titles">学生成绩列表</th>
            <tr class="titles">
                <th> 专业 </th><th> 年级 </th><th> 学号 </th><th> 姓名 </th><th> 性别 </th><th> 科目 </th><th> 成绩 </th><th> 操作 </th>
            </tr>
            <!--  两个学生示例，不计算入最后提交的 post 请求中-->
            <tr class="tr">
                <td> 计算机 </td><td> 2016级 </td><td> 20160101 </td><td> 钱权 </td><td> 男 </td><td> 数据结构 </td><td> 85 </td><td> <div class="modify">修改</div>&emsp;<div class="remove">删除</div> </td>
            </tr>
            <tr class="tr">
                <td> 物联网 </td><td> 2016级 </td><td> 20160102 </td><td> 周一夫 </td><td> 女 </td><td> C语言程序设计 </td><td> 92 </td><td> <div class="modify">修改</div>&emsp;<div class="remove">删除</div> </td>
            </tr>
        </table>
        <!--  新增信息按钮与提交按钮  -->
        <div class="divs">
            <div class="divs"  style="display: inline-block">
                <input type="button" class="buttons" id="button_add" value="新增">
            </div>
             <button type="submit" class="buttons" >提交</button>
        </div>
        <!--  空格 div 元素  -->
        <div style="height: 30px;"></div>
        <!--  学生信息新增录入部分  -->
        <div  class="divs">
            <b class="titles">学生信息录入</b>
            <hr style="width: 820px;"/>
            <!--  专业信息 / 单选框  -->
            <div class="divs">
                <div class="name">
                    <b style="color:red;">*</b>
                    <b>专业 &emsp;:</b>
                </div>
                <div class="input_divs" id="专业">
                    <input type="radio" id="major_01" name="major" value="计算机"/>
                    <label for="major_01">计算机</label>
                    <input type="radio" id="major_02" name="major" value="物联网"/>
                    <label for="major_02">物联网</label>
                    <input type="radio" id="major_03" name="major" value="通信"/>
                    <label for="major_03">通信</label>
                    <input type="radio" id="major_04" name="major" value="" style="display: none"/>
                </div>
                <div class="error"></div>
            </div>
            <!--  年级信息 / 下拉选择框 -->
            <div class="divs">
                <div class="name">
                    <b style="color:red;">*</b>
                    <b>年级 &emsp;:</b>
                </div>
                <div class="input_divs">
                    <select class="input" name="grade" style="width: 388px;height: 37px;" id="年级">
                        <option id="opt_0" value="">--请选择--</option>
                        <option value="2020级">2020级</option>
                        <option value="2019级">2019级</option>
                        <option value="2018级">2018级</option>
                        <option value="2017级">2017级</option>
                        <option value="2016级">2016级</option>
                    </select>
                </div>
                <div class="error"></div>
            </div>
            <!--  学号信息 / 文本输入框  -->
            <div class="divs">
                <div class="name">
                    <b style="color:red;">*</b>
                    <b>学号 &emsp;:</b>
                </div>
                <div class="input_divs" id="学号">
                    <input class="input" type="text" placeholder="请输入学号" name="stu_number">
                </div>
                <div class="error"></div>
            </div>
            <!--  姓名信息 / 文本输入框  -->
            <div class="divs">
                <div class="name">
                    <b style="color:red;">*</b>
                    <b>姓名 &emsp;:</b>
                </div>
                <div class="input_divs" id="姓名">
                    <input class="input" type="text" placeholder="请输入姓名" name="stu_name">
                </div>
                <div class="error"></div>
            </div>
            <!--  性别信息 / 单选框  -->
            <div class="divs">
                <div class="name">
                    <b style="color:red;">*</b>
                    <b>性别 &emsp;:</b>
                </div>
                <div class="input_divs" id="性别">
                    <input type="radio" id="sex_01" name="sex" value="男" />
                    <label for="sex_01">男</label>
                    <input type="radio" id="sex_02" name="sex" value="女"/>
                    <label for="sex_02">女</label>
                    <input type="radio" id="sex_03" name="sex" value="" style="display: none"/>
                </div>
                <div class="error"></div>
            </div>
            <!--  科目信息 / 单选框  -->
            <div class="divs">
                <div class="name">
                    <b style="color:red;">*</b>
                    <b>科目 &emsp;:</b>
                </div>
                <div class="input_divs" id="科目">
                    <input type="radio" id="class_01" name="class" value="数据结构"/>
                    <label for="class_01">数据结构</label>
                    <input type="radio" id="class_02" name="class" value="C语言程序设计"/>
                    <label for="class_02">C语言程序设计</label>
                    <input type="radio" id="class_03" name="class" value="Java语言程序设计"/>
                    <label for="class_03">Java语言程序设计</label>
                    <input type="radio" id="class_04" name="class" value="" style="display: none"/>
                </div>
                <div class="error"></div>
            </div>
            <!--  成绩信息 / 文本输入框  -->
            <div class="divs">
                <div class="name">
                    <b style="color:red;">*</b>
                    <b>成绩 &emsp;:</b>
                </div>
                <div class="input_divs" id="成绩">
                    <input class="input" type="text" placeholder="请输入成绩" name="score">
                </div>
                <div class="error"></div>
            </div>
            <!--  信息验证写入按钮  -->
            <div class="divs" style="display: inline-block">
               <input type="button" class="buttons" id="button_write" value="写入" disabled="disabled" style="background-color: darkgray">
            </div>
        </div>
    </form>
</body>
<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script>
    var data = {        // 用于存放录入信息的全局变量 字典以学生学号为key 以信息 dict 为 value
        20160101:{major:"计算机",grade: "2016级",stu_number: "20160101",stu_name: "钱权",sex: "男",class_name: "数据结构",score: "85"},
        20160102:{major:"物联网",grade: "2016级",stu_number: "20160102",stu_name: "周一夫",sex: "女",class_name: "C语言程序设计",score: "92"}
    };

    // 新增学生按钮单击事件 Jquery
    $("#button_add").click(add_stu);

    // 提交按钮单击事件
    $("#button_submit").click(submit_data);

    // 写入按钮单击事件
    $("#button_write").click(write_in);

    // 删除 单击事件
    $(".remove").click(remove);

    // 修改 单击事件
    $(".modify").click(modify);


    // 添加学生表格行
    function add_stu() {
        $("#button_write").removeAttr("disabled");      // 使 写入按钮可点 防止误操作
        $("#button_write").css("background-color","#121299")    // 恢复 写入按钮颜色
        $(this).css("background-color","lightgray") // 改变 新增按钮颜色，并禁用
        $(this).attr("disabled","disabled");
        $(".modify,.remove").css("color","lightgray"); // 改变 新增按钮颜色，并禁用
        $(".modify,.remove").unbind();
        // 表格新增行
        const tr = "<tr class='tr' id='write_in'><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td> <div class='modify'></div>&emsp;<div class='remove'></div> </td>"
        $("#table").append(tr);
    }

    // 写入学生信息
    function write_in() {
        // 取出 表单中信息对象 ( 方便操作兑现属性值 )
        const major = $("input[name='major']:checked");
        const grade = $("select[name='grade'] option:selected");
        const stu_number = $("input[name='stu_number']");
        const stu_name = $("input[name='stu_name']");
        const sex = $("input[name='sex']:checked");
        const class_name = $("input[name='class']:checked");
        const score = $("input[name='score']");
        // 将 信息对象 以 列表形式存储
        const list = [major,grade,stu_number,stu_name,sex,class_name,score];
        // 判断所有值是否 符合输入要求 是/1 否/0 返回相同大小 0/1 列表
        const judge = judge_list(list);
        // 当列表中存在非法输入时 终止事件
        if(!(judge.indexOf(0)===-1)) return;
        // 将学生信息写入数据字典;
        data[list[2].val()] = list2dict(list);
        // 全部信息输入无误 写入信息表格 并初始化文本输入框
        for(let i=0;i<list.length+1;i++){
            const select = $("#write_in").children().eq(i);
            if(i===list.length){
                select.children().eq(0).text("修改");
                select.children().eq(1).text("删除");
            }
            else {
                select.text(list[i].val());
            }
            // 将 form 置空
            if([2,3,6].indexOf(i)!==-1)
                list[i].val("");
        }
        // 将 form 表单置空
        $("#major_04").prop("checked",true);
        $("#opt_0").prop("selected",true);
        $("#sex_03").prop("checked",true);
        $("#class_04").prop("checked",true);
        // 删除 单击事件
        $(".remove").click(remove)

        // 修改 单击事件
        $(".modify").click(modify)

        $("#write_in").removeAttr("id") // 移除表格新增行的 id 属性 ，准备下次新增
        $("#button_add").removeAttr("disabled");    // 移除新增按钮禁用属性，允许再次新增
        $("#button_add").css("background-color","#121299")  // 恢复新增按钮颜色
        $(this).css("background-color","lightgray")     // 禁用 写入按钮
        $(this).attr("disabled","disabled");
        $(".modify,.remove").css("color","deepskyblue"); // 改变 新增按钮颜色，并禁用
        $(".remove").click(remove);     // 重写 删除 单击事件
        $(".modify").click(modify);     // 重写 修改 单击事件
    }

    // 删除学生信息
    function remove() {
        // 删除列表对应行
        const id = $(this).parent().prevAll().eq(4);
        // 在data数据字典中删除对应数据
        delete data[Number(id.text())];
        $(this).parent().parent().remove();
    }

    // 修改学生信息
    function modify() {
        const dict_stu = data[Number($(this).parent().prevAll().eq(4).text())];
        $("#button_add").attr("disabled","disabled");
        $("#button_add").css("background-color","lightgray")
        $("#button_write").removeAttr("disabled");      // 使 写入按钮可点 防止误操作
        $("#button_write").css("background-color","#121299")    // 恢复 写入按钮颜色
        $(".modify,.remove").css("color","lightgray"); // 改变 新增按钮颜色，并禁用
        $(".modify,.remove").unbind();
        // form 表单赋值
        $("input[value="+dict_stu["major"]+"]").prop("checked",true);
        $("option[value="+dict_stu["grade"]+"]").prop("selected",true);
        $("input[name='stu_number']").val(dict_stu['stu_number']);
        $("input[name='stu_name']").val(dict_stu['stu_name']);
        $("input[value="+dict_stu["sex"]+"]").prop("checked",true);
        $("input[value="+dict_stu["class_name"]+"]").prop("checked",true);
        $("input[name='score']").val(dict_stu['score']);

        // 在data数据字典中删除对应数据
        delete data[Number($(this).parent().prevAll().eq(4).text())];
        // 删除 table 中对应行
        $(this).parent().parent().remove();
        // 表格新增行
        const tr = "<tr class='tr' id='write_in'><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td> <div class='modify'></div>&emsp;<div class='remove'></div> </td>"
        $("#table").append(tr);
    }

    // 提交学生信息
    function submit_data() {
        $.ajax({    // 通过ajax提交data信息
            type:"POST",
            url:"success.html",
            data:data,
            success:function (){},
        });
    }

    // 判断输入合法性函数
    function judge_list(list) {
        const judge = [];
        $(".error_text").remove();
        for(let i=0;i<list.length;i++){
            judge[i] = 0;
            const name = list[i].parent().attr("id");
            switch (i) {
                case 0:{if(!list[i].val()) $("div[id='专业']").next().append("<b style='color: red;' class='error_text'>请选择专业！</b>");else judge[i] = 1;break;}
                case 1:{if(!list[i].val()) $("select[id='年级']").parent().next().append("<b style='color: red;' class='error_text'>请选择年级！</b>");else judge[i] = 1; break;}
                case 4:{if(!list[i].val()) $("div[id='性别']").next().append("<b style='color: red;' class='error_text'>请选择性别！</b>");else judge[i] = 1;break;}
                case 5:{if(!list[i].val()) $("div[id='科目']").next().append("<b style='color: red;' class='error_text'>请选择科目！</b>");else judge[i] = 1;break;}
                default:{
                    if(!list[i].val() && !list[i].parent().next().children().text())
                        list[i].parent().next().append("<b style='color: red;' class='error_text'>"+name+"不能为空！</b>");
                    else if(i===2 && list[i].val().search(/^\d{8}$/)!==0)
                        list[i].parent().next().append("<b style='color: red;' class='error_text'>学号输入错误！</b>");
                    else if(i===2 && data[Number(list[i].val())])
                        list[i].parent().next().append("<b style='color: red;' class='error_text'>该学号已存在！</b>");
                    else if(i===3 && list[i].val().length>4)
                        list[i].parent().next().append("<b style='color: red;' class='error_text'>姓名过长！</b>");
                    else if(i===6 && list[i].val().search(/^(100|[1-9]{1,2})$|^0$/)!==0)
                        list[i].parent().next().append("<b style='color: red;' class='error_text'>成绩输入错误！</b>");
                    else {
                        list[i].parent().next().children().remove();
                        judge[i] = 1;
                    }
                    break;
                }
            }

        }
        return judge;   // 返回 0/1 合法性判断列表
    }

    // 将 列表内容转换为 字典内容 并返回
    function list2dict(list) {
        const dict = {}
        dict["major"] = list[0].val();
        dict["grade"] = list[1].val();
        dict["stu_number"] = list[2].val();
        dict["stu_name"] = list[3].val();
        dict["sex"] = list[4].val();
        dict["class_name"] = list[5].val();
        dict["score"] = list[6].val();
        return dict;
    }

</script>
</html>