<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>学生成绩管理</title>
    <style>
        .input_divs{
            display: inline-block;
            margin-top: 5px;
            width: 400px;
            text-align: left;
        }
        .input{
            width: 380px;
            height: 30px;
        }
        .name{
            display: inline-block;
            text-align: right;
            width: 100px;
        }
        table.title{
            text-align: center;
            width: 800px;
            border-color: lightgray;
        }
        .buttons{
            color: white;
            background-color: #121299 ;
            border-width: 0px;
            width: 120px;
            height: 35px;
        }
        div.divs{
            margin-top: 10px;
            text-align: center;
        }
        .titles{
            font-size: 15px;

        }
        tr.tr{
            height: 35px;
        }
        .error{
            width: 150px;
            display: inline-block;
        }
        td.operation{
            color: deepskyblue;
            text-decoration: underline;
        }
    </style>
</head>
<body>

    <div style="height: 50px;"></div>
    <table class="title" id="table" border="1" cellspacing="0" align="center">
        <th colspan="8" class="titles">学生成绩列表</th>
        <tr class="titles">
            <th> 专业 </th><th> 年级 </th><th> 学号 </th><th> 姓名 </th><th> 性别 </th><th> 科目 </th><th> 成绩 </th><th> 操作 </th>
        </tr>
        <tr class="tr">
            <td> 计算机 </td><td> 2016 </td><td> 20160101 </td><td> 张三 </td><td> 男 </td><td> 数据结构 </td><td> 85 </td><td class="operation"> 修改删除 </td>
        </tr>
        <tr class="tr">
            <td> 物联网 </td><td> 2016 </td><td> 20160102 </td><td> 李四 </td><td> 女 </td><td> C语言程序设计 </td><td> 92 </td><td class="operation"> 修改删除 </td>
        </tr>
    </table>
    <div class="divs">
        <div class="divs"  style="display: inline-block">
            <button class="buttons" id="button_add">新增</button>
        </div>
        <div class="divs" style="display: inline-block">
        <input type="button" class="buttons" id="button_submit" value="提交">
        </div>
    </div>
    <div style="height: 30px;"></div>
    <div  class="divs">
        <b class="titles">学生信息录入</b>
        <hr style="width: 800px;"/>
        <form action="success.html" method="get">
            <div class="divs">
                <div class="name">
                    <b style="color:red;">*</b>
                    <b>专业 &emsp;:</b>
                </div>
                <div class="input_divs" id="专业">
                    <input type="radio" id="major_01" name="major" value="计算机" checked="checked"/>
                    <label for="major_01">计算机</label>
                    <input type="radio" id="major_02" name="major" value="物联网"/>
                    <label for="major_02">物联网</label>
                    <input type="radio" id="major_03" name="major" value="通信"/>
                    <label for="major_03">通信</label>
                </div>
                <div class="error"></div>
            </div>
            <div class="divs">
                <div class="name">
                    <b style="color:red;">*</b>
                    <b>年级 &emsp;:</b>
                </div>
                <div class="input_divs">
                    <select class="input" name="grade" style="width: 388px;height: 37px;" id="年级">
                        <option value="2020级" selected="selected">2020级</option>
                        <option value="2019级">2019级</option>
                        <option value="2018级">2018级</option>
                        <option value="2017级">2017级</option>
                        <option value="2016级">2016级</option>
                    </select>
                </div>
                <div class="error"></div>
            </div>
            <div class="divs">
                <div class="name">
                    <b style="color:red;">*</b>
                    <b>学号 &emsp;:</b>
                </div>
                <div class="input_divs" id="学号">
                    <input class="input" type="text" placeholder="请输入学号" name="stu_number">
                </div>
                <div class="error"></div>
            </div>
            <div class="divs">
                <div class="name">
                    <b style="color:red;">*</b>
                    <b>姓名 &emsp;:</b>
                </div>
                <div class="input_divs" id="姓名">
                    <input class="input" type="text" placeholder="请输入姓名" name="stu_name">
                </div>
                <div class="error"></div>
            </div>
            <div class="divs">
                <div class="name">
                    <b style="color:red;">*</b>
                    <b>性别 &emsp;:</b>
                </div>
                <div class="input_divs" id="性别">
                    <input type="radio" id="sex_01" name="sex" value="男" checked="checked"/>
                    <label for="sex_01">男</label>
                    <input type="radio" id="sex_02" name="sex" value="女"/>
                    <label for="sex_02">女</label>
                </div>
                <div class="error"></div>
            </div>
            <div class="divs">
                <div class="name">
                    <b style="color:red;">*</b>
                    <b>科目 &emsp;:</b>
                </div>
                <div class="input_divs" id="科目">
                    <input type="radio" id="class_01" name="class" value="数据结构" checked="checked"/>
                    <label for="class_01">数据结构</label>
                    <input type="radio" id="class_02" name="class" value="C语言程序设计"/>
                    <label for="class_02">C语言程序设计</label>
                    <input type="radio" id="class_03" name="class" value="Java语言程序设计"/>
                    <label for="class_03">Java语言程序设计</label>
                </div>
                <div class="error"></div>
            </div>
            <div class="divs">
                <div class="name">
                    <b style="color:red;">*</b>
                    <b>成绩 &emsp;:</b>
                </div>
                <div class="input_divs" id="成绩">
                    <input class="input" type="text" placeholder="请输入成绩" name="score">
                </div>
                <div class="error"></div>
            </div>
            <div class="divs" style="display: inline-block">
                <input type="button" class="buttons" id="button_write" value="写入" disabled="disabled" style="background-color: darkgray">
            </div>

        </form>
    </div>
</body>
<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script>
    var data = {};
    $("#button_add").click(function () {
        $("#button_write").removeAttr("disabled");
        $("#button_write").css("background-color","#121299")
        $(this).css("background-color","lightgray")
        $(this).attr("disabled","disabled");
        const tr = "<tr class='tr' id='write_in'><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td class='operation'></td></tr>"
        $("#table").append(tr);
    });

    $("#button_submit").click(function () {
        $.ajax({
            type:"POST",
            url:"success.html",
            data:data,
            success:function (){$(window).attr('location','success.html');},
        })
    })

    $("#button_write").click(function () {
        const major = $("input[name='major']:checked");
        const grade = $("select[name='grade'] option:selected");
        const stu_number = $("input[name='stu_number']");
        const stu_name = $("input[name='stu_name']");
        const sex = $("input[name='sex']:checked");
        const class_name = $("input[name='class']:checked");
        const score = $("input[name='score']");
        const list = [major,grade,stu_number,stu_name,sex,class_name,score];
        const judge = judge_list(list);
        if(!(judge.indexOf(0)==-1)) return;
        for(let i=0;i<list.length+1;i++){
            const select = $("#write_in").children().eq(i);
            if(i==list.length)
                select.text("修改删除");
            else {
                select.text(list[i].val());
            }
            if([2,3,6].indexOf(i)!=-1)
                list[i].val("");
        }
        $("#write_in").removeAttr("id")
        $("#button_add").removeAttr("disabled");
        $("#button_add").css("background-color","#121299")
        $(this).css("background-color","lightgray")
        $(this).attr("disabled","disabled");
        data[list[2]] = list2dict(list);
    });

    $(".operation").click(function () {
        $(this).parent().remove();
    })

    function judge_list(list) {
        const judge = [];
        for(let i=0;i<list.length;i++){
            judge[i] = 0;
            list[i].parent().next().children().remove();
            if(!list[i].val()){
                const name = list[i].parent().attr("id");
                if(!list[i].parent().next().children().text())  list[i].parent().next().append("<b style='color: red;' >"+name+"不能为空！</b>");
            }
            else if(i==2 && list[i].val().search(/^\d{8}$/)!=0)
                list[i].parent().next().append("<b style='color: red;' >学号输入错误！</b>");
            else if(i==3 && list[i].val().length>4)
                list[i].parent().next().append("<b style='color: red;' >姓名过长！</b>");
            else if(i==6 && list[i].val().search(/^(100|[1-9]{1,2})$|^0$/)!=0)
                list[i].parent().next().append("<b style='color: red;' >成绩输入错误！</b>");
            else {
                list[i].parent().next().children().remove();
                judge[i] = 1;
            }
        }
        return judge;
    };

    function list2dict(list) {
        const dict = {}
        dict["major"] = list[0];
        dict["grade"] = list[1];
        dict["stu_number"] = list[2];
        dict["stu_name"] = list[3];
        dict["sex"] = list[4];
        dict["class_name"] = list[5];
        dict["score"] = list[6];
        return dict;
    }

</script>
</html>